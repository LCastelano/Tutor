---
title: "Iris Multivariada"
author: "Lucas Castelano"
date: "2024-12-12"
output: html_document
---

---

```{r}
library(plyr)
```


```{r}
library(ggplot2)
library(gg3D)
library(dplyr)
library(magrittr)
```

Vamos iniciar com um conjunto de dados simples 'iris'.

---

> ### Organizar dados.

> #### **COLUNAS**

##### OPERADOR PIPE
Instalar o pct magrittr. Agora, através dos dados 'iris' vamos selecionar duas colunas e aplicar um filtro nelas. Logo após vamos fazer uma lista agrupada em 'Species' cuja única coluna seja o número de ocorrência (frequência absoluta) de cada espécie.

```{r}
iris %>% select(Species, Sepal.Width) %>%
  filter(Sepal.Width >= 3) %>% ddply(.(Species), summarise,
                                     n = sum(!is.na(Sepal.Width)))
```


##### COMO ALTERAR OS NOMES DAS COLUNAS?

* Usando o índice da coluna:
```{r}
teste <- iris

names(teste)[5] <- 'Especies'

colnames(ex1)[2] <- 'mudou';
names(ex1)[3] <- 'mudoutbm';
names(ex1)[4]<- c('aquitbm');
ex1 <- ex2
names(ex1)[c(1,3,5)] <- c('alter1', 'alter2', 'alter3')
```


##### COMO MUDAR AS COLUNAS DE POSIÇÃO?

* Ordenando através das posições do df.

```{r}
# Ordena o cj de dados da última coluna para a primeira
iris.ord <- iris[5:1]

# Ordena de acordo com as posições desejadas
iris.ord <- iris.ord[c(1,3,5,4,2)]
```

Utilizando o pacote **dply**:
* Função **select()**: Manter ou remover colunas usando seus nomes ou tipos.

```{r}
# Sem PIPE
# Adiciona um vetor com os nomes das colunas na ordem desejada:
ex1 <- select(iris, c(Species, Petal.Width, Sepal.Width, Sepal.Length, Petal.Length))

# com PIPE
ex2 <- iris %>%
  select(Species, Sepal.Width, Petal.Width, Petal.Length, Sepal.Length)

```
* Função **pull()**: remove uma coluna na forma de vetor.

```{r}
ex1 %>% pull("Species") #usando o nome da coluna a ser extraida
ex1 %>% pull("Petal.Width") # usando o índice da coluna da esquerda para direita
ex1 %>% pull(-5) #usando o índice da coluna da direita para esquerda
```


* Função **mutate()** adiciona uma coluna baseado em operações matemáticas pré-existentes.

```{r}
ex1 %>% mutate(quadPW = sqrt(Petal.Width)) # Adiciona uma coluna do quadrado de Petal.Length.

ex2 %>%  mutate(quadPL = sqrt(Petal.Length), quadPW = sqrt(Petal.Width)) # adiciona duas colunas solicitadas

```


##### COMO ALTERAR A POSIÇÃO DOS ELEMENTOS DE UMA COLUNA?

* Função **arrange()** organiza em ordem. O que muda em uma coluna é seguido por todas as outras, não embaralha linhas

```{r}
# Seleciona as colunas Sepal.Width e alter3, filtra Sepal.Width maior ou igual a 3 ou alter3 maior ou igual a 5.5 e retorna o resultado organizado do maior para o menor na coluna Sepal.Width.
ex1 %>%  select(Sepal.Width, Sepal.Length) %>% 
  filter(Sepal.Width >= 3 | Sepal.Length >= 5.5) %>% arrange(-Sepal.Width)
```

* **apply()**Aplica a função nas linhas ou colunas.

```{r}
                                                                                              summary(iris)

apply(iris[1:4], 1, sum) # 1 linhas, soma todas as linhas. Como há 150 linhas, retornará 150 resultados.

apply(iris[1:4], 2, sum) # 2 colunas, soma todas as colunas. Como há 4 colunas, retorna 4 resultados.

apply(iris[1:4], 1:2, sum) # 1:2 linhas e colunas
```

```{r}
iris %>% group_by(Species) %>% summarise(Sepal.Length >= 4.5) %>% 
  ddply(.(Species), summarise,
        media = mean(Sepal.Length))

iris %>% ggplot(aes(x=Sepal.Length, y= Sepal.Width, colour = Species))+
  geom_point()+
  geom_smooth(method = 'lm', se = F)+
  theme_bw()
```


* Como alterar os elementos de uma coluna sem afetar as demais?

* Função **group_by()**: Agrupa dados de acordo com uma coluna.

```{r}
iris %>% group_by(Species) %>%
summarise(Petal.Length = mean(Petal.Length))
# A sintaxe parece muito com a função ddply (plyr): ddply(dados, .(var.agrupamento), summarise, instruções)
```